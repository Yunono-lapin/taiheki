<!DOCTYPE html> 
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>体癖・雰囲気診断 - 結果ページ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* シェアボタン用の簡易スタイル (style.cssに移動してもOK) */
    #shareButtons {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #eee;
      text-align: center;
    }
    #shareButtons h3 {
      margin-bottom: 15px;
      font-size: 1.1em;
    }
    #shareButtons button {
      display: inline-block; /* 横並びにするために変更 */
      width: auto; /* 幅を自動調整 */
      min-width: 120px; /* 最低幅 */
      padding: 10px 15px;
      margin: 5px;
      font-size: 0.9em;
      border-radius: 5px;
      cursor: pointer;
      border: none;
      color: white;
    }
    #shareTwitter { background-color: #1DA1F2; } /* X (Twitter) Blue */
    #shareFacebook { background-color: #1877F2; } /* Facebook Blue */
    #shareLine { background-color: #00B900; } /* LINE Green */
    #copyToClipboard { background-color: #555; } /* Dark Gray */

    #shareButtons button:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>体癖・雰囲気診断 - 結果</h1>
    <div id="result">
      </div>

    <div id="resultExplanation" style="margin-top: 30px; text-align: left; padding: 0 10px;">
      </div>

    <div id="shareButtons">
      <h3>この診断結果をシェアする</h3>
      <button id="shareTwitter">Xでシェア</button>
      <button id="shareLine">LINEで送る</button>
      <button id="copyToClipboard">結果をコピー</button>
      <p id="copyFeedback" style="font-size: 0.8em; margin-top: 10px;"></p>
    </div>
    </div>

  <script>
    // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
    // ★ ステップ1：各結果に対応する解説文データ ★
    // ★ 必ずご自身でタイプ1からタイプ10までの詳細な情報を記述してください。 ★
    // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
    const resultDetails = {
      1: {
        title: "1種 頭脳タイプ：情熱を秘めた開拓者",
        physical: "ここにタイプ1の身体的特徴を記述します。\n例えば、肩幅がしっかりしている、または手足が長いなどです。",
        atmosphere: "ここにタイプ1のあなたの雰囲気を記述します。\nエネルギッシュで、人々を惹きつけるカリスマ性があるでしょう。",
        advice: "ここにタイプ1のあなたへの今後のアドバイスを記述します。\n時には休息も大切にしましょう。"
      },
      2: {
        title: "2種 頭脳タイプ：冷静沈着な分析家",
        physical: "タイプ2の身体的特徴は、比較的スリムで、知的な印象を与えることが多いです。\n指が細長いなどの特徴も見られます。",
        atmosphere: "タイプ2のあなたは、落ち着いていて論理的な雰囲気を持っています。\n物事を客観的に捉えることができるでしょう。",
        advice: "タイプ2へのアドバイスは、もっと自分の感情を表現してみることです。\n周りとのコミュニケーションが円滑になります。"
      },
      // ...タイプ3からタイプ9までのデータも同様に記述してください...
      3: {
        title: "3種 感情タイプ：人を惹きつける表現者",
        physical: "...",
        atmosphere: "...",
        advice: "..." 
      },
      4: {
        title: "4種 感情タイプ：調和を重んじる平和主義者",
        physical: "...", 
        atmosphere: "...", 
        advice: "..." 
      },
      5: {
        title: "5種 行動タイプ：知的好奇心旺盛な探求者",
        physical: "...", 
        atmosphere: "...", 
        advice: "..."
      },
      6: { 
        title: "6種 行動タイプ：誠実で責任感のある守護者", 
        physical: "...",
        atmosphere: "...", 
        advice: "..." },
      7: {
        title: "7種 闘争タイプ：楽観的で多才なエンターテイナー", 
        physical: "...",
        atmosphere: "...", 
        advice: "..."
      },
      8: { 
        title: "8種 闘争タイプ：力強く決断力のある挑戦者", 
        physical: "...", 
        atmosphere: "...", 
        advice: "..."
      },
      9: { 
        title: "9種 集中タイプ：受容的で穏やかな調停者", 
        physical: "...", 
        atmosphere: "...", 
        advice: "..."
      },
      10: {
        title: "10種 集中タイプ：ユニークな発想を持つ芸術家",
        physical: "10種の身体的特徴は...",
        atmosphere: "10種の雰囲気は...",
        advice: "10種へのアドバイスは..."
      }
    };

    // ローカルストレージから値取得
    const nickname = localStorage.getItem('nickname') || '名無し';
    const answersJSON = localStorage.getItem('answers');
    const resultDiv = document.getElementById('result');

    if (!answersJSON) {
      resultDiv.innerText = '回答データが見つかりません。診断ページからやり直してください。';
      // シェアボタンなどを非表示にする (任意)
      document.getElementById('resultExplanation').style.display = 'none';
      document.getElementById('shareButtons').style.display = 'none';
      throw new Error('回答データなし');
    }
    const answers = JSON.parse(answersJSON);

    // --- 診断ロジック (省略せず前回と同じものを記述) ---
    let baseCandidates = [];
    if (answers.q1 === 'outdoor' || answers.q1 === 'somewhat_outdoor') {
      baseCandidates = [1, 3, 5, 7, 9];
    } else if (answers.q1 === 'somewhat_indoor' || answers.q1 === 'indoor') {
      baseCandidates = [2, 4, 6, 8, 10];
    } else {
      baseCandidates = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    }

    const additionalCandidates = [];
    if (answers.q2 === '好き') additionalCandidates.push(1, 2);
    if (answers.q3 === 'とても好き') additionalCandidates.push(3, 4);
    if (answers.q4 === 'まさにその通り') additionalCandidates.push(5, 6);
    if (answers.q5 === 'かなり') additionalCandidates.push(7, 8);
    if (answers.q6 === 'かなり') additionalCandidates.push(9, 10);

    const priorityCandidates = baseCandidates.filter(num => additionalCandidates.includes(num));
    let finalCandidates = priorityCandidates.length > 0 ? priorityCandidates : baseCandidates;

    let selected;
    if (finalCandidates.length > 0) {
      selected = finalCandidates[Math.floor(Math.random() * finalCandidates.length)];
    } else {
      selected = 1;
      resultDiv.innerHTML = `<p>エラー: 診断結果を特定できませんでした。</p>`;
      document.getElementById('resultExplanation').style.display = 'none';
      document.getElementById('shareButtons').style.display = 'none';
      throw new Error('最終候補が空です');
    }
    // --- 診断ロジックここまで ---

    const detail = resultDetails[selected]; // 診断結果の詳細データを取得

    // 結果表示 (ニックネームと診断結果の数字)
    resultDiv.innerHTML = `
      <p>ニックネーム：<strong>${nickname}</strong></p>
      <p>あなたの結果は…</p>
    `;
    
    // 解説文表示
    const explanationDiv = document.getElementById('resultExplanation');
    if (detail) {
      const titleHtml = detail.title ? `<h2>${detail.title}</h2>` : `<h2>タイプ${selected}</h2>`; // titleがない場合も考慮
      const physicalHtml = detail.physical ? detail.physical.replace(/\n/g, '<br>') : '情報なし';
      const atmosphereHtml = detail.atmosphere ? detail.atmosphere.replace(/\n/g, '<br>') : '情報なし';
      const adviceHtml = detail.advice ? detail.advice.replace(/\n/g, '<br>') : '情報なし';

      explanationDiv.innerHTML = `
        ${titleHtml}
        <h3>身体的特徴</h3>
        <p>${physicalHtml}</p>
        <h3>あなたの雰囲気</h3>
        <p>${atmosphereHtml}</p>
        <h3>今後のアドバイス</h3>
        <p>${adviceHtml}</p>
      `;
    } else {
      explanationDiv.innerHTML = "<p>このタイプに関する詳細な解説は現在準備中です。</p>";
    }

    // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
    // ★ ステップ2：シェアボタンの処理 ★
    // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
    const siteUrl = window.location.href; // 現在のページのURL (GitHub PagesのURLなど)
    const siteTitle = document.title; // ページのタイトル
    const resultTitle = detail && detail.title ? detail.title : `タイプ${selected}`;
    const hashtags = "体癖診断,雰囲気診断"; // シェア時のハッシュタグ (カンマ区切り)

    // シェア用テキストの組み立て
    let shareText = `${nickname}さんの診断結果は「${resultTitle}」でした！\nあなたも診断してみよう！\n${siteTitle}\n`;

    // X (旧Twitter) シェア
    document.getElementById('shareTwitter').addEventListener('click', function() {
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(siteUrl)}&hashtags=${encodeURIComponent(hashtags)}`;
      window.open(twitterUrl, '_blank');
    });

    // Facebook シェア
    document.getElementById('shareFacebook').addEventListener('click', function() {
      // FacebookはURLのシェアがメインです。OGP設定がされていればよりリッチに表示されます。
      const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(siteUrl)}`;
      window.open(facebookUrl, '_blank');
    });

    // LINE シェア
    document.getElementById('shareLine').addEventListener('click', function() {
      const lineText = `${nickname}さんの診断結果は「${resultTitle}」でした！\n${siteTitle}\nあなたも診断してみよう！\n${siteUrl}`;
      const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(lineText)}`;
      window.open(lineUrl, '_blank');
    });

    // クリップボードにコピー
    const copyFeedbackEl = document.getElementById('copyFeedback');
    document.getElementById('copyToClipboard').addEventListener('click', function() {
      const textToCopy = `${nickname}さんの診断結果は「${resultTitle}」でした。\n\n【${resultTitle}の詳細】\n身体的特徴：\n${(detail && detail.physical) ? detail.physical : '情報なし'}\n\n雰囲気：\n${(detail && detail.atmosphere) ? detail.atmosphere : '情報なし'}\n\nアドバイス：\n${(detail && detail.advice) ? detail.advice : '情報なし'}\n\nあなたも診断してみよう！\n${siteTitle}\n${siteUrl}`;
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(textToCopy).then(function() {
          copyFeedbackEl.textContent = '結果をクリップボードにコピーしました！';
          setTimeout(() => { copyFeedbackEl.textContent = ''; }, 3000); // 3秒後にメッセージを消す
        }, function(err) {
          copyFeedbackEl.textContent = 'コピーに失敗しました。';
          console.error('クリップボードへのコピーに失敗: ', err);
        });
      } else {
        // 古いブラウザ向けのフォールバック (限定的)
        copyFeedbackEl.textContent = 'お使いのブラウザはクリップボードコピーに対応していません。';
      }
    });

    // デバッグ用
    // console.log(... 省略 ...); // 必要に応じてコメントアウトを外してください

  </script>
</body>
</html>
