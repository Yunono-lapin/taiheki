<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>MBTI診断 - 結果ページ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>MBTI診断 - 結果</h1>
    <div id="result"></div>
  </div>

   <script>
  // ローカルストレージから値取得
  const nickname = localStorage.getItem('nickname') || '名無し';
  const answersJSON = localStorage.getItem('answers');
  if (!answersJSON) {
    document.getElementById('result').innerText = '回答データが見つかりません。';
    // ※前回ご提案した「ページ間のデータ引き継ぎ」が正しく行われているかご確認ください。
    throw new Error('回答データなし');
  }
  const answers = JSON.parse(answersJSON);

  // --- ここから診断ロジック ---

  // 1. Q1の回答に基づき、「基本候補」を決定する (このグループは絶対)
  let baseCandidates = [];
  if (answers.q1 === 'outdoor' || answers.q1 === 'somewhat_outdoor') {
    baseCandidates = [1, 3, 5, 7, 9]; // 奇数グループ
  } else if (answers.q1 === 'somewhat_indoor' || answers.q1 === 'indoor') {
    baseCandidates = [2, 4, 6, 8, 10]; // 偶数グループ
  } else {
    // Q1の回答がない場合は全候補とする
    baseCandidates = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
  }

  // 2. Q2以降の回答に合致する「追加候補」のリストを作成する
  const additionalCandidates = [];
  if (answers.q2 === '好き') {
    additionalCandidates.push(1, 2);
  }
  if (answers.q3 === 'とても好き') {
    additionalCandidates.push(3, 4);
  }
  if (answers.q4 === 'まさにその通り') {
    additionalCandidates.push(5, 6);
  }
  if (answers.q5 === 'かなり') {
    additionalCandidates.push(7, 8);
  }
  if (answers.q6 === 'かなり') {
    additionalCandidates.push(9, 10);
  }
  // (page2以降の質問についても同様に .push() していく)


  // 3. 「基本候補」の中から、「追加候補」にも含まれている番号だけを抜き出し、「最有力候補」とする
  const priorityCandidates = baseCandidates.filter(num => additionalCandidates.includes(num));

  // 4. 表示する結果を決定する
  let finalCandidates;
  if (priorityCandidates.length > 0) {
    // 最有力候補が1つでもあれば、それを最終候補とする
    finalCandidates = priorityCandidates;
  } else {
    // 1つもなければ（Q1のグループとQ2以降の回答が合わなかった場合）、
    // 元の「基本候補」を最終候補とする（結果が出なくなるのを防ぐため）
    finalCandidates = baseCandidates;
  }

  // 5. 最終候補の中からランダムに1つ選択
  const selected = finalCandidates[Math.floor(Math.random() * finalCandidates.length)];

  // 結果表示
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = `
    <p>ニックネーム：<strong>${nickname}</strong></p>
    <p>あなたの結果は… <strong>${selected}</strong> 種です！</p>
  `;
  
  // デバッグ用: どのような過程で結果が決まったかコンソールで確認できます
  console.log('基本候補 (Q1):', baseCandidates);
  console.log('追加候補 (Q2以降):', additionalCandidates);
  console.log('最有力候補 (絞り込み後):', priorityCandidates);
  console.log('最終候補:', finalCandidates);

</script>
</body>
</html>
